- name: download golang tar 
  get_url:
    url: "https://storage.googleapis.com/golang/go1.17.1.linux-amd64.tar.gz"
    dest: "/home/{{ service_name }}"
    mode: 0440

- name: Extract the Go tarball
  unarchive:
    src: "/home/{{ service_name }}/go1.17.1.linux-amd64.tar.gz"
    dest: /usr/local
    copy: no

- name: modify .bashrc
  blockinfile:
    dest: "{{home_dir}}/.bashrc"
    block: |
      export GOPATH=$HOME/go
      export GOBIN=$GOPATH/bin
      export PATH=$GOBIN:$PATH:/usr/local/go/bin
    marker: '# {mark} ANSIBLE MANAGED BLOCK - changes for golang'
    insertafter: EOF
    create: yes